<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>she.store_dz - Calculator</title>
  <style>
    :root{
      --pink:#ff4fa3;
      --pink2:#ff86c8;
      --bg:#fff2f8;
      --card:#ffffff;
      --text:#1f1f1f;
      --muted:#6b6b6b;
      --shadow: 0 10px 30px rgba(255,79,163,0.18);
    }
    *{box-sizing:border-box;font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial;}
    body{
      margin:0;
      min-height:100vh;
      background: radial-gradient(1200px 600px at 20% 10%, #ffe1f0 0%, transparent 60%),
                  radial-gradient(900px 500px at 90% 20%, #ffd0e8 0%, transparent 55%),
                  linear-gradient(180deg, #fff7fb 0%, #fff2f8 100%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .app{ width:min(760px, 100%); }
    .top{
      background: linear-gradient(90deg, var(--pink) 0%, var(--pink2) 100%);
      color:white;
      border-radius:18px;
      padding:18px 16px;
      box-shadow: var(--shadow);
      text-align:center;
    }
    .top h1{ margin:0; font-size:18px; font-weight:600; letter-spacing:.2px; }
    .card{
      margin-top:14px;
      background:var(--card);
      border-radius:18px;
      padding:16px;
      box-shadow: var(--shadow);
    }
    .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 760px){
      .grid.two{ grid-template-columns: 1fr 1fr; }
    }
    .field label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    .field input{
      width:100%;
      border:1px solid #ffd1e7;
      border-radius:14px;
      padding:12px 12px;
      font-size:16px;
      outline:none;
      background:#fff;
    }
    .field input:focus{
      border-color: var(--pink);
      box-shadow: 0 0 0 4px rgba(255,79,163,0.12);
    }
    .hint{ font-size:12px; color:var(--muted); margin-top:4px; }
    .result{
      margin-top:10px;
      padding:14px;
      border-radius:16px;
      background: #fff7fb;
      border: 1px dashed #ffb8dd;
    }
    .big{ font-size:22px; font-weight:700; color:#111; margin:0 0 6px 0; }
    .small{ margin:0; font-size:13px; color:#444; line-height:1.5; }
    .tiny{ margin-top:6px; font-size:12px; color:var(--muted); }
    .invoice{
      margin-top:12px;
      padding:14px;
      border-radius:16px;
      background:#ffffff;
      border:1px solid #ffe0f0;
    }
    .invoice h3{ margin:0 0 10px 0; font-size:14px; color:#333; }
    .row{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:6px 0;
      border-bottom:1px solid #f3f3f3;
      font-size:14px;
    }
    .row:last-child{border-bottom:none;}
    .row strong{font-weight:700;}
    .actions{ display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
    button{
      border:none;
      border-radius:14px;
      padding:12px 14px;
      font-size:15px;
      cursor:pointer;
      font-weight:600;
    }
    .btn-primary{
      background: linear-gradient(90deg, var(--pink) 0%, var(--pink2) 100%);
      color:white;
      box-shadow: var(--shadow);
    }
    .btn-ghost{
      background:#fff;
      color:#333;
      border:1px solid #ffd1e7;
    }
    .footer{ text-align:center; margin-top:12px; color:#444; font-size:14px; }

    /* Ù‚Ø§Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© */
    #invoiceShot{
      position: fixed;
      left:-99999px;
      top:-99999px;
      width: 760px;
      background: white;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border: 1px solid #ffe0f0;
    }
    #invoiceShot .hdr{
      padding:16px;
      background: linear-gradient(90deg, var(--pink) 0%, var(--pink2) 100%);
      color:#fff;
      text-align:center;
    }
    #invoiceShot .hdr .t1{ font-size:16px; font-weight:700; margin:0; }
    #invoiceShot .hdr .t2{ font-size:12px; opacity:.95; margin:6px 0 0 0; }
    #invoiceShot .body{ padding:16px; }
    #invoiceShot .pill{
      display:block;
      padding:10px 12px;
      border-radius:16px;
      background:#fff2f8;
      border:1px solid #ffd1e7;
      color:#444;
      font-size:13px;
      margin-bottom:10px;
      line-height:1.6;
    }
    #invoiceShot .sum{
      margin-top:12px;
      padding:12px;
      border-radius:16px;
      background:#fff7fb;
      border:1px dashed #ffb8dd;
      text-align:center;
    }
    #invoiceShot .sum .a{ font-size:22px; font-weight:800; margin:0; }
    #invoiceShot .sum .b{ font-size:13px; margin:6px 0 0 0; color:#444; }
    #invoiceShot .thanks{
      margin-top:12px;
      text-align:center;
      font-weight:700;
      color:#333;
    }
    #invoiceShot .ftr{
      padding:10px 16px 16px;
      text-align:center;
      color:#444;
      font-size:13px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ ÙÙŠ she.store_dz</h1>
    </div>

    <div class="card">
      <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†Ø© -->
      <div class="grid two">
        <div class="field">
          <label>Ø§Ø³Ù…ÙƒÙ (Ù„Ù„ÙØ§ØªÙˆØ±Ø©)</label>
          <input id="custName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø±ÙŠÙ…" />
          <div class="hint">Ù…Ù†ÙŠÙ† ØªÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒØŒ ÙŠØ®Ø±Ø¬ Ø§Ø³Ù… Ø¯Ù„Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>
        </div>
        <div class="field">
          <label>Ø§Ø³Ù… Ø§Ù„Ø¯Ù„Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="custNick" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø±ÙŠÙˆÙ…Ø©" />
          <div class="hint">Ø¥Ø°Ø§ Ù…Ø§Ø¹Ø¬Ø¨ÙƒØ´ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ Ø§ÙƒØªØ¨ÙŠ Ø§Ù„Ø¯Ù„Ø¹ Ù‡Ù†Ø§</div>
        </div>
        <div class="field">
          <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="custPhone" type="tel" placeholder="Ù…Ø«Ø§Ù„: 05xxxxxxxx" />
        </div>
        <div class="field">
          <label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©/Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="custCity" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø³ÙŠÙ„Ø© - Ø¹ÙŠÙ† Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡" />
        </div>
      </div>

      <hr style="border:none;border-top:1px solid #ffe0f0;margin:14px 0;">

      <!-- Ø§Ù„Ø­Ø³Ø§Ø¨ -->
      <div class="grid">
        <div class="field">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</label>
          <input id="products" type="number" min="0" step="1" placeholder="Ù…Ø«Ø§Ù„: 5" />
          <div class="hint">Ø§Ù„Ø±Ø¨Ø­: 250Ø¯Ø¬ Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ù†ØªØ¬</div>
        </div>

        <div class="field">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹ (Ù„Ù„ØªØ°ÙƒÙŠØ± ÙÙ‚Ø· - Ù„Ø§ ÙŠØ¯Ø®Ù„ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨)</label>
          <input id="pieces" type="number" min="0" step="1" placeholder="Ù…Ø«Ø§Ù„: 9" />
          <div class="hint">Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§Ù†Ø© ÙÙ‚Ø· Ù„Ù„ØªØ°ÙƒÙŠØ±</div>
        </div>

        <div class="field">
          <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ($)</label>
          <input id="usd" type="number" min="0" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 25.00" />
          <div class="hint">1$ = 270Ø¯Ø¬</div>
        </div>
      </div>

      <div class="result" id="resultBox" style="display:none;">
        <p class="big" id="dzdOut">0 Ø¯Ø¬</p>
        <p class="small" id="alfOut">ÙŠØ¹Ù†ÙŠ: 0 Ø£Ù„Ù</p>
        <p class="tiny" id="noteOut"></p>

        <div class="invoice" id="invoiceBox" style="display:none;">
          <h3>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h3>

          <div class="row"><span>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†Ø©</span><span><strong id="invName">-</strong></span></div>
          <div class="row"><span>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</span><span><strong id="invPhone">-</strong></span></div>
          <div class="row"><span>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©/Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</span><span><strong id="invCity">-</strong></span></div>

          <div class="row"><span>Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</span><span><strong>270</strong> Ø¯Ø¬</span></div>
          <div class="row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</span><span><strong id="invUsd">0</strong> $</span></div>
          <div class="row"><span>ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù„Ù„Ø¯Ø¬</span><span><strong id="invConvert">0</strong> Ø¯Ø¬</span></div>
          <div class="row"><span>Ø§Ù„Ø±Ø¨Ø­ (250 Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª)</span><span><strong id="invProfit">0</strong> Ø¯Ø¬</span></div>
          <div class="row"><span>ØªØºÙ„ÙŠÙ (Ù…Ø±Ø© ÙˆØ­Ø¯Ø©)</span><span><strong id="invPack">0</strong> Ø¯Ø¬</span></div>
          <div class="row"><span><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</strong></span><span><strong id="invTotal">0</strong> Ø¯Ø¬</span></div>

          <div style="margin-top:10px;text-align:center;font-weight:700;color:#333;">
            <span id="invThanks">Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ğŸ’—</span>
          </div>
        </div>

        <div class="actions">
          <button class="btn-primary" id="downloadBtn">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ØµÙˆØ±Ø©)</button>
          <button class="btn-ghost" id="resetBtn">Ù…Ø³Ø­</button>
        </div>
      </div>

      <div class="footer">Ø´ÙƒØ±Ø§Ù‹ ÙŠØ§ Ø³ÙƒØ±Ø© Ù„Ø²ÙŠØ§Ø±ØªÙƒ ğŸ’—</div>
    </div>
  </div>

  <!-- Ù‚Ø§Ù„Ø¨ Ù…Ø®ÙÙŠ Ù„Ù„ØµÙˆØ±Ø© -->
  <div id="invoiceShot" aria-hidden="true">
    <div class="hdr">
      <p class="t1">she.store_dz - ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</p>
      <p class="t2" id="shotDate"></p>
    </div>
    <div class="body">
      <div class="pill" id="shotCustomer"></div>

      <div class="invoice" style="margin-top:0;">
        <div class="row"><span>Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</span><span><strong>270</strong> Ø¯Ø¬</span></div>
        <div class="row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</span><span><strong id="shotUsd">0</strong> $</span></div>
        <div class="row"><span>ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù„Ù„Ø¯Ø¬</span><span><strong id="shotConvert">0</strong> Ø¯Ø¬</span></div>
        <div class="row"><span>Ø§Ù„Ø±Ø¨Ø­ (250 Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª)</span><span><strong id="shotProfit">0</strong> Ø¯Ø¬</span></div>
        <div class="row"><span>ØªØºÙ„ÙŠÙ (Ù…Ø±Ø© ÙˆØ­Ø¯Ø©)</span><span><strong id="shotPack">0</strong> Ø¯Ø¬</span></div>
        <div class="row"><span><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</strong></span><span><strong id="shotTotal">0</strong> Ø¯Ø¬</span></div>
      </div>

      <div class="sum">
        <p class="a" id="shotBig">0 Ø¯Ø¬</p>
        <p class="b" id="shotAlf">ÙŠØ¹Ù†ÙŠ: 0 Ø£Ù„Ù</p>
      </div>

      <div class="thanks" id="shotThanks">Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ğŸ’—</div>
    </div>
    <div class="ftr">Ø´ÙƒØ±Ø§Ù‹ ÙŠØ§ Ø³ÙƒØ±Ø© Ù„Ø²ÙŠØ§Ø±ØªÙƒ ğŸ’—</div>
  </div>

<script>
  // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  const RATE_DZD_PER_USD = 270;
  const PROFIT_PER_PRODUCT_DZD = 250;
  const PACKAGING_DZD = 50; // Ù…Ø±Ø© ÙˆØ­Ø¯Ø©

  const elCustName = document.getElementById('custName');
  const elCustNick = document.getElementById('custNick');
  const elCustPhone= document.getElementById('custPhone');
  const elCustCity = document.getElementById('custCity');

  const elProducts = document.getElementById('products');
  const elPieces   = document.getElementById('pieces');
  const elUsd      = document.getElementById('usd');

  const resultBox  = document.getElementById('resultBox');
  const invoiceBox = document.getElementById('invoiceBox');

  const dzdOut  = document.getElementById('dzdOut');
  const alfOut  = document.getElementById('alfOut');
  const noteOut = document.getElementById('noteOut');

  const invName    = document.getElementById('invName');
  const invPhone   = document.getElementById('invPhone');
  const invCity    = document.getElementById('invCity');
  const invUsd     = document.getElementById('invUsd');
  const invConvert = document.getElementById('invConvert');
  const invProfit  = document.getElementById('invProfit');
  const invPack    = document.getElementById('invPack');
  const invTotal   = document.getElementById('invTotal');
  const invThanks  = document.getElementById('invThanks');

  const downloadBtn = document.getElementById('downloadBtn');
  const resetBtn    = document.getElementById('resetBtn');

  function formatDZD(n){
    return (Math.round(n)).toLocaleString('fr-FR');
  }

  // 1000Ø¯Ø¬ = 100 Ø£Ù„Ù  => dzd/10
  function toAlf(dzd){
    const alf = dzd / 10;
    const isInt = Math.abs(alf - Math.round(alf)) < 1e-9;
    return isInt ? String(Math.round(alf)) : alf.toFixed(1);
  }

  function firstNameOnly(name){
    const trimmed = (name || "").trim();
    if (!trimmed) return "";
    // Ø®Ø°ÙŠ Ø£ÙˆÙ„ ÙƒÙ„Ù…Ø© ÙÙ‚Ø·
    return trimmed.split(/\s+/)[0];
  }

  function makeNickname(name){
    const n = firstNameOnly(name);

    // Ù‚Ø§Ù…ÙˆØ³ Ø¯Ù„Ø¹ Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø´Ù‡ÙˆØ±Ø© (ØªÙ‚Ø¯Ø±ÙŠ ØªØ²ÙŠØ¯ÙŠ Ø¹Ù„ÙŠÙ‡ Ø¨Ø±Ø§Ø­ØªÙƒ)
    const map = {
      "Ù…Ø±ÙŠÙ…": ["Ù…Ø±ÙŠÙˆÙ…Ø©","Ù…ÙŠÙ…ÙŠ","Ù…Ø±Ù…ÙˆØ±Ø©"],
      "Ù…Ø±ÙŠÙ…Ù€": ["Ù…Ø±ÙŠÙˆÙ…Ø©","Ù…ÙŠÙ…ÙŠ"],
      "Ø³Ø§Ø±Ø©": ["Ø³ÙˆØ³Ùˆ","Ø³Ø§Ø±ØªÙŠ","Ø³Ø§Ø±Ùˆ"],
      "ÙØ§Ø·Ù…Ø©": ["ÙÙˆÙØ§","ÙØ·ÙˆÙ…Ø©","ÙÙˆÙØªÙŠ"],
      "Ø®Ø¯ÙŠØ¬Ø©": ["Ø¯ÙˆØ¯Ùˆ","Ø®Ø¯ÙŠØ¬ÙˆØ¬","Ø®Ø¯Ùˆ"],
      "Ø£Ø³Ù…Ø§Ø¡": ["Ø³Ù…Ø³Ù…","Ø³ÙˆØ³Ùˆ","Ø³Ù…Ø³ÙˆÙ…Ø©"],
      "Ø§Ø³Ù…Ø§Ø¡": ["Ø³Ù…Ø³Ù…","Ø³ÙˆØ³Ùˆ","Ø³Ù…Ø³ÙˆÙ…Ø©"],
      "Ø¥ÙŠÙ…Ø§Ù†": ["Ø¥ÙŠÙ…ÙˆÙ†Ø©","Ù…ÙŠÙ…ÙˆÙ†Ø©","Ø¥ÙŠÙ…Ùˆ"],
      "Ø§ÙŠÙ…Ø§Ù†": ["Ø¥ÙŠÙ…ÙˆÙ†Ø©","Ù…ÙŠÙ…ÙˆÙ†Ø©","Ø¥ÙŠÙ…Ùˆ"],
      "Ø³Ù†Ø¯Ø³": ["Ø³ÙˆØ³Ùˆ","Ø³Ù†Ø¯ÙˆØ³Ø©","Ø¯ÙˆØ¯Ùˆ"],
      "Ø³ÙƒÙŠÙ†Ø©": ["Ø³ÙˆÙƒÙˆ","Ø³ÙƒÙŠÙ†ÙˆÙ†Ø©","Ø³ÙˆØ³Ùˆ"],
      "Ù„ÙŠÙ„Ù‰": ["Ù„ÙˆÙ„ÙŠØªØ§","Ù„ÙˆÙ„Ùˆ","Ù„ÙŠÙ„Ùˆ"],
      "Ù†Ø³Ø±ÙŠÙ†": ["Ù†ÙˆÙ†Ùˆ","Ø³ÙˆØ³Ùˆ","Ù†Ø³Ø±ÙˆÙ†Ø©"],
      "Ø³Ù„Ù…Ù‰": ["Ø³ÙˆØ³Ùˆ","Ø³Ù„ÙˆÙ…ÙŠ","Ù„Ù…Ù‘ÙˆÙ„Ø©"],
      "Ø±ÙŠÙ…": ["Ø±ÙŠÙ…Ùˆ","Ø±ÙˆØ±Ùˆ","Ø±ÙŠÙˆÙ…Ø©"],
      "Ø¢ÙŠØ©": ["ÙŠÙˆÙŠÙˆ","Ø¢ÙŠÙˆ","Ø¢ÙŠØ§ØªÙˆ"],
      "Ø§ÙŠØ©": ["ÙŠÙˆÙŠÙˆ","Ø¢ÙŠÙˆ","Ø¢ÙŠØ§ØªÙˆ"],
      "ÙŠØ§Ø³Ù…ÙŠÙ†": ["ÙŠØ§Ø³Ùˆ","Ø³ÙˆØ³Ùˆ","ÙŠØ§Ø³Ù…ÙŠÙ†Ø©"]
    };

    if (map[n] && map[n].length) return map[n][0];

    // fallback Ù„Ø·ÙŠÙ: Ø¥Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù‚ØµÙŠØ±ØŒ Ù†Ø²ÙŠØ¯ "Ùˆ" / Ø¥Ø°Ø§ Ø·ÙˆÙŠÙ„ØŒ Ù†Ø²ÙŠØ¯ "ÙˆÙ†Ø©"
    if (!n) return "";
    if (n.length <= 3) return n + "Ùˆ";
    return n + "ÙˆÙ†Ø©";
  }

  function getDisplayNick(){
    // Ø¥Ø°Ø§ ÙƒØªØ¨Øª Ø§Ù„Ø²Ø¨ÙˆÙ†Ø© Ø¯Ù„Ø¹ Ø¨ÙŠØ¯Ù‡Ø§ Ù†Ø³ØªØ¹Ù…Ù„Ù‡
    const manual = (elCustNick.value || "").trim();
    if (manual) return manual;

    // Ø¥Ø°Ø§ Ù…Ø§ ÙƒØªØ¨ØªØ´ØŒ Ù†ÙˆÙ„Ù‘Ø¯Ùˆ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø§Ø³Ù…
    const name = (elCustName.value || "").trim();
    const auto = makeNickname(name);
    return auto || "";
  }

  function updateNickAuto(){
    // Ù†Ø®Ù„ÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¯Ù„Ø¹ ØªØªØ¹Ù…Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙØ§Ø±ØºØ© (ÙˆÙ…Ø§ Ù†ÙƒØ³Ø±ÙˆØ´ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø¥Ø°Ø§ ÙƒØªØ¨ØªÙ‡Ø§)
    const manual = (elCustNick.value || "").trim();
    if (manual) return;
    const auto = makeNickname(elCustName.value || "");
    elCustNick.value = auto;
  }

  function calc(){
    const products = Math.max(0, Number(elProducts.value || 0));
    const usd = Math.max(0, Number(elUsd.value || 0));

    const convert = usd * RATE_DZD_PER_USD;
    const profit  = products * PROFIT_PER_PRODUCT_DZD;

    const hasSomething = (products > 0) || (usd > 0);
    const pack = hasSomething ? PACKAGING_DZD : 0;

    const total = convert + profit + pack;

    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†Ø©
    const name = (elCustName.value || "").trim();
    const phone= (elCustPhone.value || "").trim();
    const city = (elCustCity.value || "").trim();
    const nick = getDisplayNick();

    // show/hide
    if (!hasSomething){
      resultBox.style.display = 'none';
      invoiceBox.style.display = 'none';
      return;
    }
    resultBox.style.display = 'block';
    invoiceBox.style.display = 'block';

    dzdOut.textContent = `${formatDZD(total)} Ø¯Ø¬`;
    alfOut.textContent = `ÙŠØ¹Ù†ÙŠ: ${toAlf(total)} Ø£Ù„Ù`;

    const pieces = Number(elPieces.value || 0);
    noteOut.textContent = pieces > 0
      ? `ØªØ°ÙƒÙŠØ±: Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© = ${pieces} (Ù…Ø§ ØªØ¯Ø®Ù„Ø´ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨)`
      : '';

    // invoice details
    invName.textContent  = name ? firstNameOnly(name) : "-";
    invPhone.textContent = phone || "-";
    invCity.textContent  = city || "-";

    invUsd.textContent = usd.toFixed(2);
    invConvert.textContent = formatDZD(convert);
    invProfit.textContent  = formatDZD(profit);
    invPack.textContent    = formatDZD(pack);
    invTotal.textContent   = formatDZD(total);

    // Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ + Ø¯Ù„Ø¹
    if (nick){
      invThanks.textContent = `Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ${nick} ğŸ’—`;
    } else if (name){
      invThanks.textContent = `Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ${firstNameOnly(name)} ğŸ’—`;
    } else {
      invThanks.textContent = `Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ğŸ’—`;
    }
  }

  function resetAll(){
    elCustName.value = '';
    elCustNick.value = '';
    elCustPhone.value = '';
    elCustCity.value = '';

    elProducts.value = 1;
    elPieces.value = 1;
    elUsd.value = '';
    calc();
  }

  // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒØµÙˆØ±Ø© PNG
  function downloadInvoiceAsPNG(){
    const products = Math.max(0, Number(elProducts.value || 0));
    const pieces   = Math.max(0, Number(elPieces.value || 0));
    const usd      = Math.max(0, Number(elUsd.value || 0));

    const hasSomething = (products > 0) || (usd > 0);
    if (!hasSomething){
      alert("Ø¯Ø®Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø¨Ø§Ø´ Ù†Ø®Ø±Ù‘Ø¬Ùˆ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ğŸ˜Š");
      return;
    }

    const convert = usd * RATE_DZD_PER_USD;
    const profit  = products * PROFIT_PER_PRODUCT_DZD;
    const pack    = PACKAGING_DZD;
    const total   = convert + profit + pack;

    const name = (elCustName.value || "").trim();
    const phone= (elCustPhone.value || "").trim();
    const city = (elCustCity.value || "").trim();
    const nick = getDisplayNick();

    const d = new Date();
    const pad = (x)=> String(x).padStart(2,'0');
    document.getElementById('shotDate').textContent =
      `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}  ${pad(d.getHours())}:${pad(d.getMinutes())}`;

    const customerLines = [
      `Ø§Ù„Ø§Ø³Ù…: ${name ? firstNameOnly(name) : "-"}`,
      `Ø§Ù„Ù‡Ø§ØªÙ: ${phone || "-"}`,
      `Ø§Ù„ÙˆÙ„Ø§ÙŠØ©/Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©: ${city || "-"}`,
      `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${products}  â€¢  Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹ (ØªØ°ÙƒÙŠØ±): ${pieces}  â€¢  $${usd.toFixed(2)}`
    ];
    document.getElementById('shotCustomer').textContent = customerLines.join("  |  ");

    document.getElementById('shotUsd').textContent     = usd.toFixed(2);
    document.getElementById('shotConvert').textContent = formatDZD(convert);
    document.getElementById('shotProfit').textContent  = formatDZD(profit);
    document.getElementById('shotPack').textContent    = formatDZD(pack);
    document.getElementById('shotTotal').textContent   = formatDZD(total);

    document.getElementById('shotBig').textContent = `${formatDZD(total)} Ø¯Ø¬`;
    document.getElementById('shotAlf').textContent = `ÙŠØ¹Ù†ÙŠ: ${toAlf(total)} Ø£Ù„Ù`;

    const thanks = nick ? `Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ${nick} ğŸ’—` : (name ? `Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ${firstNameOnly(name)} ğŸ’—` : `Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ğŸ’—`);
    document.getElementById('shotThanks').textContent = thanks;

    const node = document.getElementById('invoiceShot');
    const width = node.offsetWidth;
    const height = node.offsetHeight;

    // clone node (SVG foreignObject)
    const cloned = node.cloneNode(true);
    cloned.style.position = "static";
    cloned.style.left = "0";
    cloned.style.top = "0";

    const serializer = new XMLSerializer();
    const html = serializer.serializeToString(cloned);

    const svg = `
      <svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">
        <foreignObject width="100%" height="100%">
          <div xmlns="http://www.w3.org/1999/xhtml">${html}</div>
        </foreignObject>
      </svg>
    `;

    const svgBlob = new Blob([svg], {type: "image/svg+xml;charset=utf-8"});
    const url = URL.createObjectURL(svgBlob);

    const img = new Image();
    img.onload = () => {
      const scale = 2;
      const canvas = document.createElement('canvas');
      canvas.width = width * scale;
      canvas.height = height * scale;
      const ctx = canvas.getContext('2d');
      ctx.scale(scale, scale);
      ctx.drawImage(img, 0, 0);

      URL.revokeObjectURL(url);

      canvas.toBlob((blob) => {
        const pngUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = pngUrl;
        a.download = "she_store_dz_invoice.png";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(pngUrl);
      }, "image/png");
    };
    img.onerror = () => {
      URL.revokeObjectURL(url);
      alert("Ù…Ø§Ù‚Ø¯Ø±ØªØ´ Ù†Ø®Ø±Ù‘Ø¬ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù‡Ø§Ø° Ø§Ù„Ù…ØªØµÙØ­. Ø¬Ø±Ø¨ÙŠ Google Chrome.");
    };
    img.src = url;
  }

  // Ø£Ø­Ø¯Ø§Ø«
  elCustName.addEventListener('input', () => { updateNickAuto(); calc(); });
  elCustNick.addEventListener('input', calc);
  elCustPhone.addEventListener('input', calc);
  elCustCity.addEventListener('input', calc);

  elProducts.addEventListener('input', calc);
  elUsd.addEventListener('input', calc);
  elPieces.addEventListener('input', calc);

  downloadBtn.addEventListener('click', downloadInvoiceAsPNG);
  resetBtn.addEventListener('click', resetAll);

  // defaults
  resetAll();
</script>
</body>
                                                                      </html>
