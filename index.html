<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>she.store_dz</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">

  <!-- html2canvas Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒØµÙˆØ±Ø© -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root{
      --pink-1:#ffe8f1;
      --pink-2:#ffd3e4;
      --pink-4:#ff6aa8;
      --pink-5:#ff3f90;
      --pink-dark:#d81b73;
      --text:#2a2a2a;
      --muted:#7a7a7a;
      --card:#ffffff;
      --line:#ffd0e1;
      --shadow: 0 10px 26px rgba(216,27,115,.12);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Tajawal", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--pink-1), #fff 46%, #fff);
      color:var(--text);
    }
    .wrap{
      width:100%;
      max-width: 460px;
      margin:0 auto;
      padding: 12px 12px 16px;
      min-height: 100svh;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .header{
      background: linear-gradient(90deg, var(--pink-4), var(--pink-5));
      color:#fff;
      border-radius: 22px;
      padding: 14px 12px;
      text-align:center;
      box-shadow: var(--shadow);
      font-weight: 900;
      font-size: 18px;
    }
    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid var(--line);
      overflow:hidden;
    }
    .section{ padding: 12px; }

    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 800;
    }
    input{
      width:100%;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid #ffd3e4;
      outline: none;
      font-size: 15px;
      background: #fff;
      transition:.15s ease;
    }
    input:focus{
      border-color: var(--pink-4);
      box-shadow: 0 0 0 4px rgba(255,106,168,.15);
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø§Ù„Ø¯Ø¬ */
    .dzdBox{
      margin-top: 10px;
      background: linear-gradient(90deg, #f065a8, var(--pink-dark));
      color:#fff;
      border-radius: 18px;
      padding: 10px 12px;
      text-align:center;
    }
    .dzdValue{
      font-size: 24px;
      font-weight: 900;
      line-height: 1.05;
      margin: 0;
    }
    .meaning{
      margin: 6px 0 0;
      font-size: 18px; /* ÙƒØ¨ÙŠØ±Ø© ÙˆÙˆØ§Ø¶Ø­Ø© */
      font-weight: 900;
    }

    .afterBoxThanks{
      text-align:center;
      margin-top: 8px;
      color:#c2185b;
      font-weight: 900;
      font-size: 14px;
    }
    .heart{ color: var(--pink-dark); }

    /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
    .invoiceHead{
      background: #ffd9e8;
      padding: 10px 12px;
      font-weight: 900;
      text-align:center;
      border-bottom: 1px dashed #ffb7d1;
      font-size: 15px;
    }

    /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø±Ù‚Ù… + ØªØ§Ø±ÙŠØ®) */
    .meta{
      display:flex;
      justify-content:space-between;
      gap:8px;
      padding: 10px 12px 0;
    }
    .meta span{
      display:inline-block;
      background:#fff;
      border: 1px solid #ffd0e1;
      border-radius: 12px;
      padding: 5px 8px;
      font-weight: 900;
      color:#6a6a6a;
      font-size: 12px;
      white-space: nowrap;
    }

    /* Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†Ø© */
    .formGrid{ display:grid; gap:10px; padding: 10px 12px 12px; }

    /* Ø´ÙƒÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø«Ù„ Ø§Ù„ÙƒØ§Ø¨ØªÙŠØ± (Ø³Ø·ÙˆØ± + Ø¹Ù†Ø§ÙˆÙŠÙ† ÙƒØ¨Ø§Ø±) */
    .invoiceShot{
      padding: 10px 12px 12px;
      background:#fff;
    }
    .capRow{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap: 10px;
      padding: 10px 0 12px;
      border-bottom: 2px solid #ffd0e1;
    }
    .capLabel{
      color:#8a8a8a;
      font-weight: 900;
      font-size: 20px;   /* ÙƒØ¨ÙŠØ± ÙƒÙŠÙ…Ø§ Ø§Ù„ÙƒØ§Ø¨ØªÙŠØ± */
      line-height:1.1;
    }
    .capValue{
      font-weight: 900;
      font-size: 22px;   /* Ù‚ÙŠÙ…Ø© ÙˆØ§Ø¶Ø­Ø© */
      color:#111;
      text-align:left;
      direction:ltr;
      line-height:1.1;
      max-width: 55%;
      overflow-wrap:anywhere;
    }
    .capValue.ar{
      direction:rtl;
      text-align:right;
    }
    .capSmallValue{
      font-weight: 900;
      font-size: 20px;
    }

    .stamp{
      text-align:center;
      margin: 10px auto 6px;
      width: fit-content;
      padding: 6px 10px;
      border-radius: 14px;
      border: 2px dashed #ffd0e1;
      color: var(--pink-dark);
      font-weight: 900;
      font-size: 12px;
    }

    .thankLine{
      text-align:center;
      padding: 6px 12px 0;
      color:#c2185b;
      font-weight: 900;
      font-size: 22px;
    }
    .noteLine{
      text-align:center;
      padding: 6px 12px 12px;
      color:#7a2450;
      font-weight: 900;
      font-size: 18px;
      line-height:1.35;
    }

    .actions{
      display:flex;
      gap: 10px;
      padding: 10px 12px 12px;
      border-top: 1px solid #ffe0ec;
      background: #fff7fb;
    }
    button{
      flex:1;
      border:none;
      border-radius: 16px;
      padding: 11px 10px;
      font-weight: 900;
      cursor:pointer;
      font-size: 14px;
    }
    .btnClear{
      background: #fff;
      border: 1px solid #ffb7d1;
      color: #c2185b;
    }
    .btnDownload{
      background: linear-gradient(90deg, var(--pink-4), var(--pink-5));
      color:#fff;
      box-shadow: 0 10px 18px rgba(255,63,144,.18);
    }

    @media (max-width:360px){
      .capLabel{font-size:18px}
      .capValue{font-size:20px}
      .thankLine{font-size:20px}
      .noteLine{font-size:16px}
      .dzdValue{font-size:22px}
      .meaning{font-size:17px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ ÙÙŠ she.store_dz</div>

    <!-- Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„ÙÙˆÙ‚ (ÙˆØ§Ø¬Ø¯Ø© 1 Ùˆ1) -->
    <div class="card">
      <div class="section">
        <div class="row2">
          <div>
            <label for="products">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
            <input id="products" inputmode="numeric" value="1" />
          </div>
          <div>
            <label for="pieces">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹</label>
            <input id="pieces" inputmode="numeric" value="1" />
          </div>
        </div>

        <div style="margin-top:10px">
          <label for="usd">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ($)</label>
          <input id="usd" inputmode="decimal" value="" />
        </div>

        <div class="dzdBox" aria-live="polite">
          <p class="dzdValue" id="dzdText">0 Ø¯Ø¬</p>
          <p class="meaning" id="meaningText">ÙŠØ¹Ù†ÙŠ: 0</p>
        </div>

        <div class="afterBoxThanks">Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ ÙŠØ§ Ø³ÙƒØ±Ø© Ù„Ø²ÙŠØ§Ø±ØªÙƒ <span class="heart">ğŸ’—</span></div>
      </div>
    </div>

    <!-- ÙØ§ØªÙˆØ±Ø© ÙˆØ­Ø¯Ø© -->
    <div class="card" id="invoiceCard">
      <div class="invoiceHead">ÙØ§ØªÙˆØ±ØªÙƒ</div>

      <div class="meta">
        <span id="invNo">ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù…: â€”</span>
        <span id="invDt">â€”</span>
      </div>

      <div class="formGrid">
        <div>
          <label for="fullName">Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label>
          <input id="fullName" />
        </div>
        <div>
          <label for="address">Ø§Ù„Ø³ÙƒÙ† (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label>
          <input id="address" />
        </div>
        <div>
          <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label>
          <input id="phone" inputmode="tel" />
        </div>
      </div>

      <!-- Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù‡Ùˆ Ø§Ù„Ù„ÙŠ ÙŠØªØµÙˆØ± ÙˆÙŠÙ†Ø²Ù„ ÙƒØµÙˆØ±Ø© (Ø´ÙƒÙ„ ÙƒØ§Ø¨ØªÙŠØ±) -->
      <div class="invoiceShot" id="invoiceShot">
        <div class="capRow">
          <div class="capLabel">Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨</div>
          <div class="capValue ar" id="capName">-</div>
        </div>
        <div class="capRow">
          <div class="capLabel">Ø§Ù„Ø³ÙƒÙ†</div>
          <div class="capValue ar" id="capAddress">-</div>
        </div>
        <div class="capRow">
          <div class="capLabel">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
          <div class="capValue" id="capPhone">-</div>
        </div>
        <div class="capRow">
          <div class="capLabel">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
          <div class="capValue capSmallValue" id="capProducts">1</div>
        </div>
        <div class="capRow" style="border-bottom:none">
          <div class="capLabel">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
          <div class="capValue capSmallValue" id="capTotal">0 Ø¯Ø¬</div>
        </div>

        <div class="stamp" id="stampLine">she.store_dz âœ”</div>

        <div class="thankLine" id="thankLine">ğŸ’—</div>
        <div class="noteLine">Ø¹Ù†Ø¯ Ù…ÙˆØ§ÙÙ‚ØªÙƒ Ù„Ù„Ø´Ø±Ø§Ø¡ Ø§Ø±Ø³Ù„ÙŠ Ø±Ø§Ø¨Ø· Ø³Ù„Ø© Ù…Ø¹ ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø®Ø§Øµ âœ…ğŸ“±</div>
      </div>

      <div class="actions">
        <button class="btnDownload" id="downloadBtn" type="button">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ØµÙˆØ±Ø©)</button>
        <button class="btnClear" id="clearBtn" type="button">Ù…Ø³Ø­</button>
      </div>
    </div>
  </div>

  <script>
    /* Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø³Ø§Ø¨ (Ù…Ø®ÙÙŠ) */
    const USD_TO_DZD = 270;
    const PROFIT_PER_PRODUCT = 250;
    const PACKAGING_FEE = 50;

    /* Ø¯Ù„Ø¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ */
    const nickMap = new Map([
      ["Ø±Ø­Ø§Ø¨","Ø±Ø­ÙˆØ¨Ø©"],
      ["ÙØ±Ø­","ÙØ±ÙØ±"],
      ["Ø³Ù†Ø¯Ø³","Ø³ÙˆØ³Ùˆ"],
      ["Ø§Ù…Ø§Ù„","Ø§Ù…ÙˆÙ„Ø©"], ["Ø£Ù…Ø§Ù„","Ø§Ù…ÙˆÙ„Ø©"],
      ["Ù‡Ù†Ø§Ø¯ÙŠ","Ù‡Ù†ÙˆØ¯Ø©"],
      ["Ø§ÙŠØ©","Ø§ÙŠÙˆØªØ©"], ["Ø¢ÙŠØ©","Ø§ÙŠÙˆØªØ©"],
      ["Ø®Ù„ÙŠØµØ©","Ø®Ù„ÙˆØµØ©"],
      ["ØªÙ‚ÙˆÙ‰","ØªÙ‚Ùˆ"],
      ["Ø§ÙƒØ±Ø§Ù…","ÙƒØ±ÙˆÙ…"], ["Ø¥ÙƒØ±Ø§Ù…","ÙƒØ±ÙˆÙ…"],
      ["Ø¶Ø­Ù‰","Ø¶Ø­Ùˆ"],
      ["Ø±Ø­Ù…Ø©","Ø±Ø­ÙˆÙ…Ø©"],
      ["Ø´ÙŠÙ…Ø§Ø¡","Ø´ÙŠÙ…Ùˆ"],
      ["Ø§Ø´ÙˆØ§Ù‚","Ø´ÙˆØ´Ùˆ"], ["Ø£Ø´ÙˆØ§Ù‚","Ø´ÙˆØ´Ùˆ"],
      ["Ø¯Ø¹Ø§Ø¡","Ø¯Ø¹Ø¯Ø¹"],
      ["Ø¨Ø³Ù…Ù„Ø©","Ø¨Ø³ÙˆÙ…Ø©"],
      ["Ø³Ù„Ù…Ù‰","Ø³Ù„Ù…ÙˆØ´"],
      ["Ù„Ø¨Ù†Ù‰","Ù„Ø¨Ù†Ø§ØªÙŠ"],
      ["Ø§Ø³Ø±Ø§Ø¡","Ø§ÙŠØ³Ø±ÙŠ"], ["Ø¥Ø³Ø±Ø§Ø¡","Ø§ÙŠØ³Ø±ÙŠ"],
      ["Ø¨ØªÙˆÙ„","Ø¨ØªÙˆÙ„ÙŠ"],
      ["Ø±ÙˆÙ…ÙŠØ³Ø©","Ø±ÙˆÙ…ÙŠ"],
      ["Ø§ÙŠÙ…Ø§Ù†","Ø§Ù…ÙˆÙ†Ø©"], ["Ø¥ÙŠÙ…Ø§Ù†","Ø§Ù…ÙˆÙ†Ø©"],
      ["Ø­Ù†ÙŠÙ†","Ø­Ù†ÙˆÙ†"],
      ["Ø±ÙˆÙŠØ¯Ø©","Ø±ÙˆØ±Ùˆ"],
      ["Ù‡Ø¯ÙŠÙ„","Ù‡Ø¯ÙˆÙ„Ø©"],
      ["ÙƒÙ†Ø¯Ø©","ÙƒÙ†Ø¯ÙˆØ´"],
      ["Ø§Ø±ÙŠØ¬","Ø¬ÙˆØ¬Ø§"], ["Ø£Ø±ÙŠØ¬","Ø¬ÙˆØ¬Ø§"],
      ["Ø§Ù…ÙŠÙ†Ø©","Ø§Ù…ÙŠÙ†Ùˆ"], ["Ø£Ù…ÙŠÙ†Ø©","Ø§Ù…ÙŠÙ†Ùˆ"],
      ["ØµÙˆÙ†ÙŠØ§","ØµÙ†ØµÙ†"],
      ["Ø³Ø¹Ø§Ø¯","Ø³ÙˆØ³Ùˆ"],
      ["Ù…Ø±ÙˆÙ‰","Ù…ÙŠÙ…ÙŠ"],
      ["Ù…Ø±ÙŠÙ…","Ù…Ø±ÙŠÙˆÙ…Ø©"],
      ["Ø¬Ù‡Ø§Ø¯","Ø¬Ù‡ÙˆØ¯Ø©"],
      ["Ù†Ø³Ø±ÙŠÙ†","Ù†Ø³Ø±ÙŠÙ†Ø©"],
      ["Ù†Ø¯Ù‰","Ù†Ø¯ÙˆØ´"],
      ["Ù…Ù†Ø©","Ù…Ù†ÙˆØ´"],
      ["ÙØªÙŠØ­Ø©","ÙØªÙˆØ­"],
      ["Ø§Ø³ÙŠÙ„","Ø§Ø³ÙˆÙ„Ø©"], ["Ø£Ø³ÙŠÙ„","Ø§Ø³ÙˆÙ„Ø©"],
      ["ÙˆØ±Ø¯Ø©","ÙˆØ±Ø¯ÙˆØ´"],
      ["ÙˆØ¦Ø§Ù…","ÙˆØ¦ÙˆÙ…"],
      ["ÙˆØµØ§Ù„","ÙˆØµÙˆÙ„"],
      ["Ø§ÙŠÙ†Ø§Ø³","Ø§Ù†ÙˆØ³Ø©"], ["Ø¥ÙŠÙ†Ø§Ø³","Ø§Ù†ÙˆØ³Ø©"],
      ["Ù…Ø±Ø§Ù…","Ù…Ø±ÙˆØ´"],
      ["Ø¹ÙˆØ§Ø·Ù","Ø¹Ø·ÙˆÙØªÙŠ"]  /* âœ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    ]);

    const elProducts = document.getElementById("products");
    const elPieces   = document.getElementById("pieces"); // Ù„Ù„ØªØ°ÙƒÙŠØ± ÙÙ‚Ø·
    const elUsd      = document.getElementById("usd");

    const dzdText = document.getElementById("dzdText");
    const meaningText = document.getElementById("meaningText");

    const fullName = document.getElementById("fullName");
    const address  = document.getElementById("address");
    const phone    = document.getElementById("phone");

    const capName     = document.getElementById("capName");
    const capAddress  = document.getElementById("capAddress");
    const capPhone    = document.getElementById("capPhone");
    const capProducts = document.getElementById("capProducts");
    const capTotal    = document.getElementById("capTotal");
    const thankLine   = document.getElementById("thankLine");

    const invNo = document.getElementById("invNo");
    const invDt = document.getElementById("invDt");

    const clearBtn = document.getElementById("clearBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const invoiceShot = document.getElementById("invoiceShot");

    function toNumber(val){
      if(!val) return 0;
      val = String(val).replace(",", ".").replace(/[^\d.]/g, "");
      const n = parseFloat(val);
      return Number.isFinite(n) ? n : 0;
    }
    function toInt(val){
      if(!val) return 0;
      val = String(val).replace(/[^\d]/g, "");
      const n = parseInt(val, 10);
      return Number.isFinite(n) ? n : 0;
    }
    function clean(s){
      return (s || "").trim().replace(/\s+/g," ");
    }
    function firstName(full){
      const t = clean(full);
      if(!t) return "";
      return t.split(" ")[0];
    }

    /* fallback: Ø£ÙˆÙ„ Ø­Ø±ÙÙŠÙ† + "ÙˆØ´" */
    function fallbackNick(name){
      const n = clean(name);
      if(!n) return "";
      const two = n.slice(0,2);
      return two ? (two + "ÙˆØ´") : "";
    }
    function getNick(full){
      const f = firstName(full);
      if(!f) return "";
      return nickMap.get(f) || fallbackNick(f);
    }

    /* Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¬ Ø¨Ø¯ÙˆÙ† ÙÙˆØ§ØµÙ„ */
    function formatDA(n){
      const x = Math.max(0, Math.round(n));
      return String(x) + " Ø¯Ø¬";
    }

    /* "ÙŠØ¹Ù†ÙŠ" Ø¨Ø§Ù„ÙØ±Ù†Ùƒ:
       1000Ø¯Ø¬ => 100 Ø£Ù„Ù
       10000Ø¯Ø¬ => Ù…Ù„ÙŠÙˆÙ†
       15000Ø¯Ø¬ => Ù…Ù„ÙŠÙˆÙ† Ùˆ500 Ø£Ù„Ù
       20000Ø¯Ø¬ => Ø²ÙˆØ¬ Ù…Ù„Ø§ÙŠÙ†
       24000Ø¯Ø¬ => Ø²ÙˆØ¬ Ù…Ù„Ø§ÙŠÙ† Ùˆ400 Ø£Ù„Ù
    */
    function meaningFrancs(dzd){
      const da = Math.max(0, Math.trunc(Number(dzd) || 0));
      const francs = da * 100;

      const MILLION = 1000000;
      const THOUSAND = 1000;

      const millions = Math.floor(francs / MILLION);
      const thousands = Math.floor((francs % MILLION) / THOUSAND); // "Ø£Ù„Ù" Ø¨Ø§Ù„ÙØ±Ù†Ùƒ

      function millionWord(m){
        if(m === 0) return "";
        if(m === 1) return "Ù…Ù„ÙŠÙˆÙ†";
        if(m === 2) return "Ø²ÙˆØ¬ Ù…Ù„Ø§ÙŠÙ†";
        return String(m) + " Ù…Ù„Ø§ÙŠÙ†";
      }
      function thousandWord(t){
        if(t === 0) return "";
        if(t === 1) return "Ø£Ù„Ù";
        if(t === 2) return "Ø£Ù„ÙÙŠÙ†";
        return String(t) + " Ø£Ù„Ù";
      }

      if(millions > 0 && thousands > 0) return millionWord(millions) + " Ùˆ" + thousandWord(thousands);
      if(millions > 0) return millionWord(millions);
      if(thousands > 0) return thousandWord(thousands);
      return "0";
    }

    function calcTotalDZD(){
      const p = Math.max(1, toInt(elProducts.value));
      elProducts.value = String(p);

      const usd = toNumber(elUsd.value);

      // Ø§Ù„Ø­Ø³Ø§Ø¨ (Ù…Ø®ÙÙŠ): Ø¯ÙˆÙ„Ø§Ø±->Ø¯Ø¬ + Ø±Ø¨Ø­/Ù…Ù†ØªØ¬ + ØªØºÙ„ÙŠÙ Ù…Ø±Ø© ÙˆØ­Ø¯Ø©
      return Math.max(0, Math.round((usd * USD_TO_DZD) + (p * PROFIT_PER_PRODUCT) + PACKAGING_FEE));
    }

    function setMeta(){
      const now = new Date();
      const d = now.toLocaleDateString("ar-DZ");
      const t = now.toLocaleTimeString("ar-DZ", {hour:"2-digit", minute:"2-digit"});

      invDt.textContent = d + " â€¢ " + t;

      // Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© Ø¨Ø³ÙŠØ· (ÙŠØªØ¨Ø¯Ù„ ÙƒÙ„ Refresh / Ù…Ø³Ø­)
      const r = Math.floor(1000 + Math.random()*9000);
      invNo.textContent = "ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù…: SH-" + r;
    }

    function updateUI(){
      const p = Math.max(1, toInt(elProducts.value));
      const total = calcTotalDZD();

      dzdText.textContent = formatDA(total);
      meaningText.textContent = "ÙŠØ¹Ù†ÙŠ: " + meaningFrancs(total);

      capName.textContent = clean(fullName.value) || "-";
      capAddress.textContent = clean(address.value) || "-";
      capPhone.textContent = clean(phone.value) || "-";
      capProducts.textContent = String(p);
      capTotal.textContent = formatDA(total);

      const nm = clean(fullName.value);
      if(nm){
        const nick = getNick(nm);
        thankLine.innerHTML = `Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ <span class="heart">${nick}</span> <span class="heart">ğŸ’—</span>`;
      }else{
        thankLine.textContent = "ğŸ’—";
      }
    }

    let rafId = null;
    function scheduleUpdate(){
      if(rafId) cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(() => {
        rafId = null;
        updateUI();
      });
    }

    ["input","change","keyup"].forEach(evt=>{
      elProducts.addEventListener(evt, scheduleUpdate);
      elPieces.addEventListener(evt, scheduleUpdate);
      elUsd.addEventListener(evt, scheduleUpdate);
      fullName.addEventListener(evt, scheduleUpdate);
      address.addEventListener(evt, scheduleUpdate);
      phone.addEventListener(evt, scheduleUpdate);
    });

    clearBtn.addEventListener("click", ()=>{
      elProducts.value = "1";
      elPieces.value = "1";
      elUsd.value = "";
      fullName.value = "";
      address.value = "";
      phone.value = "";
      setMeta();
      scheduleUpdate();
      window.scrollTo({top:0, behavior:"smooth"});
    });

    downloadBtn.addEventListener("click", async ()=>{
      const n = clean(fullName.value);
      const a = clean(address.value);
      const ph = clean(phone.value);

      if(!n || !a || !ph){
        alert("Ù„Ø§Ø²Ù… ØªØ¹Ù…Ù‘Ø±ÙŠ: Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù„Ù‚Ø¨ + Ø§Ù„Ø³ÙƒÙ† + Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
        return;
      }

      // Ù†ØµÙˆØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø´ÙƒÙ„ Ø§Ù„ÙƒØ§Ø¨ØªÙŠØ± (Ø§Ù„Ø¬Ø²Ø¡ Ù‡Ø°Ø§ ÙÙ‚Ø·)
      const canvas = await html2canvas(invoiceShot, {
        backgroundColor: "#ffffff",
        scale: 2,
        useCORS: true
      });

      const link = document.createElement("a");
      link.download = "ÙØ§ØªÙˆØ±Ø©_she.store_dz.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø©
    setMeta();
    updateUI();
  </script>
</body>
</html>
```î¨0î¨‚
